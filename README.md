# cpp-transport-catalogue

## –û–ø–∏—Å–∞–Ω–∏–µ
–ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–∞—Ö –∏ –º–∞—Ä—à—Ä—É—Ç–∞—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ C++17 —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞:
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –ë—ã—Å—Ç—Ä—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥)
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π (–ø–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–µ–∑–¥–∫–∏)

### –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (C++23)
‚ñ∏ –°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –∞–≤—Ç–æ–±—É—Å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
‚ñ∏ –û–±—Ä–∞–±–æ—Ç–∫–∞ JSON-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|---|---|---|
| –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | In-memory –∫–∞—Ç–∞–ª–æ–≥ —Å –±—ã—Å—Ç—Ä—ã–º –ø–æ–∏—Å–∫–æ–º | `unordered_map`, –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ JSON | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç | –°–∞–º–æ–ø–∏—Å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä, `std::variant` |
| –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SVG –∫–∞—Ä—Ç —Å –≥–µ–æ–ø—Ä–∏–≤—è–∑–∫–æ–π | –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è SVG –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
| –ü–æ–∏—Å–∫ –ø—É—Ç–∏ | –ê–ª–≥–æ—Ä–∏—Ç–º –î–µ–π–∫—Å—Ç—Ä—ã | –¢–µ–æ—Ä–∏—è –≥—Ä–∞—Ñ–æ–≤, –≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ —Ä–µ–±—Ä–∞ |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
|–û–ø–µ—Ä–∞—Ü–∏—è|	–°–ª–æ–∂–Ω–æ—Å—Ç—å	|–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ|
|---|---|---|
|–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏|	O(1)|	–•–µ—à-—Ç–∞–±–ª–∏—Ü–∞|
|–ü–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–∞	|O(1)	|–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ|
|–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—É—Ç–∏	|O(E + V log V)|	–ê–ª–≥–æ—Ä–∏—Ç–º –î–µ–π–∫—Å—Ç—Ä—ã|

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
- ‚úÖ STL-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫)
- ‚úÖ string_view + —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ä—Å–µ—Ä, —è–¥—Ä–æ, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é)
- ‚úÖ –®–∞–±–ª–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã
- ‚úÖ Runtime-–ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º —Å std::variant


**–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏**
- üî∏ –†–∞–±–æ—Ç—É —Å –ø–∞–º—è—Ç—å—é –≤ C++
- üî∏ –†–µ–∞–ª–∏–∑–∞—Ü–∏—é –≥—Ä–∞—Ñ–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
- üî∏ –û–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–æ–∂–Ω—ã—Ö JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä

## –í–æ–∑–º–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
![–ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç—ã](https://pictures.s3.yandex.net/resources/ts_1647600900.svg)

### 1. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–û—Å—Ç–∞–Ω–æ–≤–∫–∏**: –Ω–∞–∑–≤–∞–Ω–∏–µ + –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- **–ú–∞—Ä—à—Ä—É—Ç—ã**:
  - –ö–æ–ª—å—Ü–µ–≤—ã–µ (A‚ÜíB‚ÜíC‚ÜíA)
  - –õ–∏–Ω–µ–π–Ω—ã–µ (A‚ÜíB‚ÜíC‚ÜíB‚ÜíA)
- **–†–∞—Å—Å—Ç–æ—è–Ω–∏—è** –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏

### 2. –ó–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ JSON

#### –ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ JSON 
```json
  {
      "base_requests": [
          {
              "is_roundtrip": true,
              "name": "297",
              "stops": [
                  "Biryulyovo Zapadnoye",
                  "Biryulyovo Tovarnaya",
                  "Universam",
                  "Biryulyovo Zapadnoye"
              ],
              "type": "Bus"
          },
          {
              "is_roundtrip": false,
              "name": "635",
              "stops": [
                  "Biryulyovo Tovarnaya",
                  "Universam",
                  "Prazhskaya"
              ],
              "type": "Bus"
          },
          {
              "latitude": 55.574371,
              "longitude": 37.6517,
              "name": "Biryulyovo Zapadnoye",
              "road_distances": {
                  "Biryulyovo Tovarnaya": 2600
              },
              "type": "Stop"
          },
          {
              "latitude": 55.587655,
              "longitude": 37.645687,
              "name": "Universam",
              "road_distances": {
                  "Biryulyovo Tovarnaya": 1380,
                  "Biryulyovo Zapadnoye": 2500,
                  "Prazhskaya": 4650
              },
              "type": "Stop"
          },
          {
              "latitude": 55.592028,
              "longitude": 37.653656,
              "name": "Biryulyovo Tovarnaya",
              "road_distances": {
                  "Universam": 890
              },
              "type": "Stop"
          },
          {
              "latitude": 55.611717,
              "longitude": 37.603938,
              "name": "Prazhskaya",
              "road_distances": {},
              "type": "Stop"
          }
      ],
      "render_settings": {
          "bus_label_font_size": 20,
          "bus_label_offset": [
              7,
              15
          ],
          "color_palette": [
              "green",
              [
                  255,
                  160,
                  0
              ],
              "red"
          ],
          "height": 200,
          "line_width": 14,
          "padding": 30,
          "stop_label_font_size": 20,
          "stop_label_offset": [
              7,
              -3
          ],
          "stop_radius": 5,
          "underlayer_color": [
              255,
              255,
              255,
              0.85
          ],
          "underlayer_width": 3,
          "width": 200
      },
      "routing_settings": {
          "bus_velocity": 40,
          "bus_wait_time": 6
      },
      "stat_requests": [
          {
              "id": 1,
              "name": "297",
              "type": "Bus"
          },
          {
              "id": 2,
              "name": "635",
              "type": "Bus"
          },
          {
              "id": 3,
              "name": "Universam",
              "type": "Stop"
          },
          {
              "from": "Biryulyovo Zapadnoye",
              "id": 4,
              "to": "Universam",
              "type": "Route"
          },
          {
              "from": "Biryulyovo Zapadnoye",
              "id": 5,
              "to": "Prazhskaya",
              "type": "Route"
          }
      ]
  }
``` 

#### –ü—Ä–∏–º–µ—Ä –≤–∑–æ–¥–Ω–æ–≥–æ JSON —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
```JSON
{
    "base_requests": [
    {
        "type": "Bus",
        "name": "114",
        "stops": ["–ú–æ—Ä—Å–∫–æ–π –≤–æ–∫–∑–∞–ª", "–†–∏–≤—å–µ—Ä—Å–∫–∏–π –º–æ—Å—Ç"],
        "is_roundtrip": false
    },
    {
        "type": "Stop",
        "name": "–†–∏–≤—å–µ—Ä—Å–∫–∏–π –º–æ—Å—Ç",
        "latitude": 43.587795,
        "longitude": 39.716901,
        "road_distances": {"–ú–æ—Ä—Å–∫–æ–π –≤–æ–∫–∑–∞–ª": 850}
    },
    {
        "type": "Stop",
        "name": "–ú–æ—Ä—Å–∫–æ–π –≤–æ–∫–∑–∞–ª",
        "latitude": 43.581969,
        "longitude": 39.719848,
        "road_distances": {"–†–∏–≤—å–µ—Ä—Å–∫–∏–π –º–æ—Å—Ç": 850}
    }
    ],
    "render_settings": {
    "width": 200,
    "height": 200,
    "padding": 30,
    "stop_radius": 5,
    "line_width": 14,
    "bus_label_font_size": 20,
    "bus_label_offset": [7, 15],
    "stop_label_font_size": 20,
    "stop_label_offset": [7, -3],
    "underlayer_color": [255,255,255,0.85],
    "underlayer_width": 3,
    "color_palette": ["green", [255,160,0],"red"]
    },
    "stat_requests": [
    { "id": 1, "type": "Map" },
    { "id": 2, "type": "Stop", "name": "–†–∏–≤—å–µ—Ä—Å–∫–∏–π –º–æ—Å—Ç" },
    { "id": 3, "type": "Bus", "name": "114" }
    ]
}
```

#### –í—ã—Ö–æ–¥–Ω–æ–π JSON —Å–æ —Å—Ç—Ä–æ–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ SVG
```JSON
[
    {
        "map": "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">\n  <polyline points=\"100.817,170 30,30 100.817,170\" fill=\"none\" stroke=\"green\" stroke-width=\"14\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n  <text fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" x=\"100.817\" y=\"170\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\">114</text>\n  <text fill=\"green\" x=\"100.817\" y=\"170\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\">114</text>\n  <text fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" x=\"30\" y=\"30\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\">114</text>\n  <text fill=\"green\" x=\"30\" y=\"30\" dx=\"7\" dy=\"15\" font-size=\"20\" font-family=\"Verdana\" font-weight=\"bold\">114</text>\n  <circle cx=\"100.817\" cy=\"170\" r=\"5\" fill=\"white\"/>\n  <circle cx=\"30\" cy=\"30\" r=\"5\" fill=\"white\"/>\n  <text fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" x=\"100.817\" y=\"170\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\">–ú–æ—Ä—Å–∫–æ–π –≤–æ–∫–∑–∞–ª</text>\n  <text fill=\"black\" x=\"100.817\" y=\"170\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\">–ú–æ—Ä—Å–∫–æ–π –≤–æ–∫–∑–∞–ª</text>\n  <text fill=\"rgba(255,255,255,0.85)\" stroke=\"rgba(255,255,255,0.85)\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" x=\"30\" y=\"30\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\">–†–∏–≤—å–µ—Ä—Å–∫–∏–π –º–æ—Å—Ç</text>\n  <text fill=\"black\" x=\"30\" y=\"30\" dx=\"7\" dy=\"-3\" font-size=\"20\" font-family=\"Verdana\">–†–∏–≤—å–µ—Ä—Å–∫–∏–π –º–æ—Å—Ç</text>\n</svg>",
        "request_id": 1
    },
    {
        "buses": [
            "114"
        ],
        "request_id": 2
    },
    {
        "curvature": 1.23199,
        "request_id": 3,
        "route_length": 1700,
        "stop_count": 3,
        "unique_stop_count": 2
    }
]
```
#### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —Å –∑–∞–ø—Ä–æ—Å–∞
![–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞](https://i.imgur.com/hZmnhIQ.png)

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å JSON:**

```cpp
json::Builder{}
    .StartDict()
        .Key("–º–∞—Ä—à—Ä—É—Ç").StartArray()
            .Value("297").Value("635")
        .EndArray()
    .EndDict()
    .Build()
```


## UML –¥–∏–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤
```mermaid
classDiagram
    direction TB
    
    class main {
        +main() int
    }
    
    class TransportCatalogue {
        -stops_: deque~Stop~
        -buses_: deque~Bus~
        -stop_index_: unordered_map~string_view, Stop*~
        -bus_index_: unordered_map~string_view, Bus*~
        -distances_: unordered_map~pair~Stop*, Stop*~, int~
        +AddStop(Stop) void
        +AddBus(Bus) void
        +FindBus(string_view) Bus*
        +FindStop(string_view) Stop*
        +GetBusInfo(string_view) BusInfo
        +GetStopInfo(string_view) StopInfo
    }
    
    class domain_Stop {
        +name: string
        +coordinates: geo_Coordinates
    }
    
    class domain_Bus {
        +name: string
        +stops: vector~Stop*~
        +is_roundtrip: bool
    }
    
    class geo_Coordinates {
        +lat: double
        +lng: double
    }
    
    class json_reader_JsonReader {
        -document_: json_Document
        -catalogue_: TransportCatalogue
        +LoadBase() void
        +ProcessRequests() void
        -ParseColor(json_Node) variant~string, vector~double~~
    }
    
    class json_Node {
        -value_: variant~nullptr_t,Array,Dict,bool,int,double,string~
        +AsArray() Array
        +AsMap() Dict
        +IsInt() bool
    }
    
    class json_Builder {
        -root_: Node
        -nodes_stack_: vector~Node*~
        +Key(string) KeyItemContext
        +Value(Node::Value) Builder&
    }
    
    class renderer_MapRenderer {
        -settings_: RenderSettings
        -projector_: SphereProjector
        +Render(const TransportCatalogue&) svg_Document
    }
    
    class svg_Document {
        -objects_: deque~unique_ptr~Object~~
        +Add(Circle|Text|Polyline)
        +Render(ostream&) void
    }
    
    class svg_Object {
        <<interface>>
        +Render(RenderContext) void
    }
    
    class request_handler_RequestHandler {
        -catalogue_: const TransportCatalogue&
        -renderer_: const renderer_MapRenderer&
        +GetBusInfo(string_view) optional~BusInfo~
        +RenderMap() svg_Document
    }
    
    class transport_router_TransportRouter {
        -graph_: graph_DirectedWeightedGraph~double~
        -router_: unique_ptr~graph_Router~double~~
        +BuildRoute(string_view, string_view) optional~RoutingResult~
    }
    
    class graph_DirectedWeightedGraph~Weight~ {
        -edges_: vector~graph_Edge~Weight~~
        -incidence_lists_: vector~graph_IncidenceList~
        +AddEdge(graph_Edge~Weight~) graph_EdgeId
    }
    
    class graph_Router~Weight~ {
        -graph_: const graph_DirectedWeightedGraph~Weight~
        +BuildRoute(graph_VertexId, graph_VertexId) optional~graph_RouteInfo~Weight~~
    }
    
    main --> json_reader_JsonReader
    main --> request_handler_RequestHandler
    
    TransportCatalogue ..> domain_Stop : depends
    TransportCatalogue ..> domain_Bus : depends
    domain_Stop ..> geo_Coordinates : depends
    
    json_reader_JsonReader --> json_Document
    json_reader_JsonReader --> TransportCatalogue
    json_reader_JsonReader ..> request_handler_RequestHandler : creates
    
    request_handler_RequestHandler --> TransportCatalogue
    request_handler_RequestHandler --> renderer_MapRenderer
    request_handler_RequestHandler ..> transport_router_TransportRouter : uses
    
    renderer_MapRenderer --> svg_Document
    svg_Document *--> svg_Object
    svg_Object <|.. svg_Circle
    svg_Object <|.. svg_Text
    svg_Object <|.. svg_Polyline
    
    transport_router_TransportRouter *--> graph_DirectedWeightedGraph~double~
    transport_router_TransportRouter *--> graph_Router~double~

    class json_Document {
        -root_: json_Node
        +GetRoot() json_Node
    }
    
    class json_Node {
        -value_: variant~nullptr_t,Array,Dict,bool,int,double,string~
        +AsArray() Array
        +AsMap() Dict
        +IsInt() bool
        +AsInt() int
        +AsDouble() double
        +AsString() string
    }
    
    class json_Builder {
        -root_: json_Node
        -nodes_stack_: vector~json_Node*~
        -current_key_: string
        +Key(string) KeyItemContext
        +Value(Node::Value) json_Builder&
        +StartDict() DictItemContext
        +StartArray() ArrayItemContext
        +EndDict() json_Builder&
        +EndArray() json_Builder&
        +Build() json_Node
    }
    
    class json_Builder_Contexts {
        <<nesting>>
        class BaseContext
        class DictItemContext
        class KeyItemContext
        class ArrayItemContext
    }
    
    json_Document "1" *-- "1" json_Node
    json_Builder "1" *-- "1" json_Node
    json_Builder "1" *-- "*" json_Node : nodes_stack_
    json_Builder ..> json_Builder_Contexts
    json_reader_JsonReader "1" *-- "1" json_Document
    json_Builder ..|> json_Node : builds

```
